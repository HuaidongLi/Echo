# Echo â€” å¼€æºç¤¾åŒºç³»ç»Ÿ

>æœ¬é¡¹ç›®æ˜¯forkè€Œæ¥ï¼Œæ„Ÿè°¢åŸä½œè€…çš„ä¸åå¼€æºï¼Œæ­å»ºäº†æ•´ä¸ªé¡¹ç›®ï¼Œä½†æ˜¯åœ¨å¤ç›˜çš„è¿‡ç¨‹å½“ä¸­ï¼Œå‘ç°äº†é¡¹ç›®å½“ä¸­çš„å¾ˆå¤šæœ‰å¾…æ”¹è¿›ä¹‹å¤„ã€‚åç»­ä¼šæ•´ç†ä¸ç¨‹åºé€»è¾‘æ¡†å›¾ä¹‹åå¼€æºï¼Œæ•¬è¯·å…³æ³¨ã€‚

ä½œä¸ºç®€å†å½“ä¸­çš„é¡¹ç›®ï¼Œæ”¹è¿›ç‚¹ç®€è¿°ï¼š
1. å‰åç«¯äº¤äº’é€»è¾‘éç°ä¸‹ä¸»æµ MVC çš„å‰åç«¯åˆ†ç¦»çš„æ¨¡å¼ï¼Œå°†ä½¿ç”¨ Vue3 è¿›è¡Œå‰åç«¯æ•´ä½“é¡¹ç›®é‡æ„ã€‚
2. æœ¬äººä¸»è¦çš„æ±‚èŒç›®çš„ä¸ºåç«¯å¼€å‘ï¼Œæ•…ä¸‹åˆ—æ”¹è¿›æ–¹å‘ä¸»è¦é’ˆå¯¹äºåç«¯ï¼š
   - å¸–å­ç›´æ¥å­˜å‚¨äº MySQL å½“ä¸­ï¼Œå¯¹äºè¾ƒé•¿çš„æ–‡æœ¬æ¥è¯´ï¼Œä¸æ˜¯ä¸€ä»¶å¥½äº‹ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´ change buffer å’Œ buffer pool çš„é¢‘ç¹åˆ·ç›˜ï¼Œæ–‡ä»¶ IO å‹åŠ›è¿‡å¤§ã€‚
   - Redis ç¼“å­˜äº†å¸–å­çš„ç‚¹èµä»¥åŠåšä¸»çš„followeeï¼Œåœ¨ç”Ÿäº§æ¡ä»¶ä¸‹ä¼šäº§ç”Ÿå¤§ key é—®é¢˜ï¼Œéœ€è¿›è¡Œè¿ç§»ã€‚
   - Spring Security çš„è®¤è¯éƒ¨åˆ†å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰æ‹¦æˆªå™¨æ›¿ä»£ï¼Œé‰´æƒéƒ¨åˆ†ä½¿ç”¨è¿‡æ»¤å™¨è¿›è¡Œæ›¿ä»£ï¼Œ
   - å¸–å­çš„æŸ¥è¯¢å¯èƒ½å‡ºç°ç¼“å­˜ç©¿é€ä¸å‡»ç©¿ã€‚
3. å¼•å…¥ AIï¼Œå¯¹å¸–å­å®ç°æ‘˜è¦åŠŸèƒ½ï¼Œä½†éœ€é¿å…å¹»è§‰ã€Prompt æ³¨å…¥ç­‰é—®é¢˜ã€‚
4. ç”±äºè¦è§£å†³ 1ï¼Œå¼•å…¥äº†å¯¹è±¡å­˜å‚¨åŠŸèƒ½ï¼Œå­˜åœ¨å­¤å„¿æ–‡ä»¶ä¸ä¸ä¸€è‡´é—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€‚

åç»­æ›´æ–°ä¸»è¦åŒ…æ‹¬åŠŸèƒ½ç‚¹çš„å®Œå–„ä¸æ”¹è¿›ã€hightlightçš„æ•´ç†ï¼Œå¦‚æœ‰å…¶ä»–å»ºè®®ï¼Œè¯·æäº¤ issueã€‚

> This project is forked , thanks to the original author of the open source , build the entire project , but in the process of review , found a lot of the project to be improved . Subsequently will be organized with the program logic block diagram after the open source , please pay attention to .

As a resume of the project , the improvement points are briefly described :
1. Front and back end interaction logic is not the current mainstream MVC front and back end separation model , will use Vue3 for the front and back end of the overall project refactoring. 
2. I am mainly looking for a job for the purpose of back-end development, so the following improvement direction is mainly aimed at the back-end:
   - Posts are stored directly in MySQL, which is not a good thing for long text, and can easily lead to frequent flushes of the change buffer and buffer pool, resulting in too much file IO pressure.
   - Redis caches the likes of posts and the followers of bloggers, which is a big key problem under production conditions and needs to be migrated.
   - The authentication part of Spring Security can be replaced by a custom interceptor, and the authentication part can be replaced by a filter.
   - The query of posts may have cache penetration and breakdown.
3. Introduce AI to summarize the posts, but avoid problems such as illusions and Prompt injection. 4.
4. introduce object storage function due to solve 1, there are orphan files with inconsistent problem solution.

Subsequent updates mainly include the refinement and improvement of function points and the organization of hightlight. If you have any other suggestions, please submit an issue.

---

<br>

<p align="center">
    <img width="" src="https://gitee.com/veal98/images/raw/master/img/20210211175136.png" >
</p>

<div align="center">


[![star](https://gitee.com/veal98/Echo/badge/star.svg?theme=dark)](https://gitee.com/veal98/Echo/stargazers)
[![fork](https://gitee.com/veal98/Echo/badge/fork.svg?theme=dark)](https://gitee.com/veal98/Echo/members)
[![GitHub stars](https://img.shields.io/github/stars/Veal98/Echo?logo=github)](https://github.com/Veal98/Echo/stargazers)
[![GitHub forks](https://img.shields.io/github/forks/Veal98/Echo?logo=github)](https://github.com/Veal98/Echo/network)
[![version](https://img.shields.io/badge/version-2.1-brightgreen)]()


</div>

> å„ä½å¯ä»¥å‚è€ƒé…å¥—æ•™ç¨‹è‡ªå·±æ‹‰ä¸‹å»éƒ¨ç½²

## ğŸ“š é¡¹ç›®ç®€ä»‹

Echo æ˜¯ä¸€å¥—å‰åç«¯ä¸åˆ†ç¦»çš„å¼€æºç¤¾åŒºç³»ç»Ÿï¼ŒåŸºäºç›®å‰ä¸»æµ Java Web æŠ€æœ¯æ ˆï¼ˆSpringBoot + MyBatis + MySQL + Redis + Kafka + Elasticsearch + Spring Security + ...ï¼‰ï¼Œå¹¶æä¾›è¯¦ç»†çš„å¼€å‘æ–‡æ¡£å’Œé…å¥—æ•™ç¨‹ã€‚åŒ…å«å¸–å­ã€è¯„è®ºã€ç§ä¿¡ã€ç³»ç»Ÿé€šçŸ¥ã€ç‚¹èµã€å…³æ³¨ã€æœç´¢ã€ç”¨æˆ·è®¾ç½®ã€æ•°æ®ç»Ÿè®¡ç­‰æ¨¡å—ã€‚

**æºç é“¾æ¥**ï¼šå·²æ‰˜ç®¡åœ¨ Github å’Œ Giteeï¼š

- Giteeï¼š[https://gitee.com/veal98/Echo](https://gitee.com/veal98/Echo)ï¼ˆGitee å®˜æ–¹æ¨èé¡¹ç›®ï¼‰
- Githubï¼š[https://github.com/Veal98/Echo](https://github.com/Veal98/Echo)

**æ•™ç¨‹åœ°å€**ï¼šæ–‡æ¡£é€šè¿‡ <u>Docsify + Github/Gitee Pages</u> ç”Ÿæˆ

- [https://itmtx.cn/column/12](https://itmtx.cn/column/12)


## ğŸ’» æ ¸å¿ƒæŠ€æœ¯æ ˆ

åç«¯ï¼š

- Spring
- Spring Boot 2.1.5 RELEASE
- Spring MVC
- ORMï¼šMyBatis
- æ•°æ®åº“ï¼šMySQL 5.7
- åˆ†å¸ƒå¼ç¼“å­˜ï¼šRedis
- æœ¬åœ°ç¼“å­˜ï¼šCaffeine
- æ¶ˆæ¯é˜Ÿåˆ—ï¼šKafka 2.13-2.7.0
- æœç´¢å¼•æ“ï¼šElasticsearch 6.4.3
- å®‰å…¨ï¼šSpring Security
- é‚®ä»¶ä»»åŠ¡ï¼šSpring Mail
- åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡ï¼šSpring Quartz
- æ—¥å¿—ï¼šSLF4Jï¼ˆæ—¥å¿—æ¥å£ï¼‰ + Logbackï¼ˆæ—¥å¿—å®ç°ï¼‰

å‰ç«¯ï¼š

- Thymeleaf
- Bootstrap 4.x
- Jquery
- Ajax

## ğŸ”¨ å¼€å‘ç¯å¢ƒ

- æ“ä½œç³»ç»Ÿï¼šWindows 10
- æ„å»ºå·¥å…·ï¼šApache Maven
- é›†æˆå¼€å‘å·¥å…·ï¼šIntellij IDEA
- åº”ç”¨æœåŠ¡å™¨ï¼šApache Tomcat
- æ¥å£æµ‹è¯•å·¥å…·ï¼šPostman
- å‹åŠ›æµ‹è¯•å·¥å…·ï¼šApache JMeter
- ç‰ˆæœ¬æ§åˆ¶å·¥å…·ï¼šGit
- Java ç‰ˆæœ¬ï¼š8

## ğŸ€ ç•Œé¢å±•ç¤º

é¦–é¡µï¼š

![](https://gitee.com/veal98/images/raw/master/img/20210211205641.png)

ç™»å½•é¡µï¼š

![](https://gitee.com/veal98/images/raw/master/img/20210211205558.png)

å¯†ç é‡ç½®é¡µï¼š

![](https://gitee.com/veal98/images/raw/master/img/20210709003428.png)

å¸–å­å‘å¸ƒé¡µï¼ˆæ”¯æŒ MarkDownï¼‰ï¼š

![](https://gitee.com/veal98/images/raw/master/img/20210512101041.png)

å¸–å­è¯¦æƒ…é¡µï¼ˆMarkDown æ¸²æŸ“ï¼‰ï¼š

![](https://gitee.com/veal98/images/raw/master/img/20210512101202.png)

å¸–å­è¯¦æƒ…é¡µï¼š

![](https://gitee.com/veal98/images/raw/master/img/20210211205741.png)



ä¸ªäººä¸»é¡µï¼š

![](https://gitee.com/veal98/images/raw/master/img/20210211205820.png)

æœ‹å‹ç§ä¿¡é¡µï¼š

![](https://gitee.com/veal98/images/raw/master/img/20210211205857.png)

ç§ä¿¡è¯¦æƒ…é¡µï¼š

![](https://gitee.com/veal98/images/raw/master/img/20210211205948.png)

ç³»ç»Ÿé€šçŸ¥é¡µï¼š

![](https://gitee.com/veal98/images/raw/master/img/20210211210122.png)

é€šçŸ¥è¯¦æƒ…é¡µï¼š

![](https://gitee.com/veal98/images/raw/master/img/20210211210152.png)

è´¦å·è®¾ç½®é¡µï¼š

![](https://gitee.com/veal98/images/raw/master/img/20210211210238.png)

æ•°æ®ç»Ÿè®¡é¡µï¼š

![](https://gitee.com/veal98/images/raw/master/img/20210211210323.png)

æœç´¢è¯¦æƒ…é¡µï¼š

![](https://gitee.com/veal98/images/raw/master/img/20210211210531.png)

## ğŸ¨ åŠŸèƒ½åˆ—è¡¨

![](https://gitee.com/veal98/images/raw/master/img/20210208222403.png)

- [x] **æ³¨å†Œ**
- [x] **ç™»å½• | ç™»å‡º**
  - åŠ¨æ€ç”ŸæˆéªŒè¯ç 
  - è®°ä½æˆ‘
- [x] **è´¦å·è®¾ç½®**
  - ä¿®æ”¹å¤´åƒ
  - ä¿®æ”¹å¯†ç 
- [x] **è¿‡æ»¤æ•æ„Ÿè¯**
  - å‰ç¼€æ ‘
- [x] **å¸–å­æ¨¡å—**
  - å‘å¸ƒå¸–å­ï¼ˆè¿‡æ»¤æ•æ„Ÿè¯ï¼‰
  - åˆ†é¡µæ˜¾ç¤ºæ‰€æœ‰çš„å¸–å­
    - æ”¯æŒæŒ‰ç…§ â€œå‘å¸–æ—¶é—´â€ æ˜¾ç¤º
    - æ”¯æŒæŒ‰ç…§ â€œçƒ­åº¦æ’è¡Œâ€ æ˜¾ç¤ºï¼ˆSpring Quartzï¼‰
  - æŸ¥çœ‹å¸–å­è¯¦æƒ…
  - æƒé™ç®¡ç†ï¼ˆSpring Security + Thymeleaf Securityï¼‰
    - æœªç™»å½•ç”¨æˆ·æ— æ³•å‘å¸–
    - â€œç‰ˆä¸»â€ å¯ä»¥çœ‹åˆ°å¸–å­çš„ç½®é¡¶å’ŒåŠ ç²¾æŒ‰é’®å¹¶æ‰§è¡Œç›¸åº”æ“ä½œ
    - â€œç®¡ç†å‘˜â€ å¯ä»¥çœ‹åˆ°å¸–å­çš„åˆ é™¤æŒ‰é’®å¹¶æ‰§è¡Œç›¸åº”æ“ä½œ
    - â€œæ™®é€šç”¨æˆ·â€ æ— æ³•çœ‹åˆ°å¸–å­çš„ç½®é¡¶ã€åŠ ç²¾ã€åˆ é™¤æŒ‰é’®ï¼Œä¹Ÿæ— æ³•æ‰§è¡Œç›¸åº”æ“ä½œ
- [x] **è¯„è®ºæ¨¡å—**
  - å‘å¸ƒå¯¹å¸–å­çš„è¯„è®ºï¼ˆè¿‡æ»¤æ•æ„Ÿè¯ï¼‰
  - åˆ†é¡µæ˜¾ç¤ºè¯„è®º
  - å‘å¸ƒå¯¹è¯„è®ºçš„å›å¤ï¼ˆè¿‡æ»¤æ•æ„Ÿè¯ï¼‰
  - æƒé™ç®¡ç†ï¼ˆSpring Securityï¼‰
    - æœªç™»å½•ç”¨æˆ·æ— æ³•ä½¿ç”¨è¯„è®ºåŠŸèƒ½
- [x] **ç§ä¿¡æ¨¡å—**
  - å‘é€ç§ä¿¡ï¼ˆè¿‡æ»¤æ•æ„Ÿè¯ï¼‰
  - ç§ä¿¡åˆ—è¡¨
    - æŸ¥è¯¢å½“å‰ç”¨æˆ·çš„ä¼šè¯åˆ—è¡¨
    - æ¯ä¸ªä¼šè¯åªæ˜¾ç¤ºä¸€æ¡æœ€æ–°çš„ç§ä¿¡
    - æ”¯æŒåˆ†é¡µæ˜¾ç¤º
  - ç§ä¿¡è¯¦æƒ…
    - æŸ¥è¯¢æŸä¸ªä¼šè¯æ‰€åŒ…å«çš„æ‰€æœ‰ç§ä¿¡
    - è®¿é—®ç§ä¿¡è¯¦æƒ…æ—¶ï¼Œå°†æ˜¾ç¤ºçš„ç§ä¿¡è®¾ä¸ºå·²è¯»çŠ¶æ€
    - æ”¯æŒåˆ†é¡µæ˜¾ç¤º
  - æƒé™ç®¡ç†ï¼ˆSpring Securityï¼‰
    - æœªç™»å½•ç”¨æˆ·æ— æ³•ä½¿ç”¨ç§ä¿¡åŠŸèƒ½
- [x] **ç»Ÿä¸€å¤„ç† 404 / 500 å¼‚å¸¸**
  - æ™®é€šè¯·æ±‚å¼‚å¸¸
  - å¼‚æ­¥è¯·æ±‚å¼‚å¸¸
- [x] **ç»Ÿä¸€è®°å½•æ—¥å¿—**
- [x] **ç‚¹èµæ¨¡å—**
  - æ”¯æŒå¯¹å¸–å­ã€è¯„è®º/å›å¤ç‚¹èµ
  - ç¬¬ 1 æ¬¡ç‚¹èµï¼Œç¬¬ 2 æ¬¡å–æ¶ˆç‚¹èµ
  - é¦–é¡µç»Ÿè®¡å¸–å­çš„ç‚¹èµæ•°é‡
  - è¯¦æƒ…é¡µç»Ÿè®¡å¸–å­å’Œè¯„è®º/å›å¤çš„ç‚¹èµæ•°é‡
  - è¯¦æƒ…é¡µæ˜¾ç¤ºå½“å‰ç™»å½•ç”¨æˆ·çš„ç‚¹èµçŠ¶æ€ï¼ˆèµè¿‡äº†åˆ™æ˜¾ç¤ºå·²èµï¼‰
  - ç»Ÿè®¡æˆ‘çš„è·èµæ•°é‡
  - æƒé™ç®¡ç†ï¼ˆSpring Securityï¼‰
    - æœªç™»å½•ç”¨æˆ·æ— æ³•ä½¿ç”¨ç‚¹èµç›¸å…³åŠŸèƒ½
- [x] **å…³æ³¨æ¨¡å—**
  - å…³æ³¨åŠŸèƒ½
  - å–æ¶ˆå…³æ³¨åŠŸèƒ½
  - ç»Ÿè®¡ç”¨æˆ·çš„å…³æ³¨æ•°å’Œç²‰ä¸æ•°
  - æˆ‘çš„å…³æ³¨åˆ—è¡¨ï¼ˆæŸ¥è¯¢æŸä¸ªç”¨æˆ·å…³æ³¨çš„äººï¼‰ï¼Œæ”¯æŒåˆ†é¡µ
  - æˆ‘çš„ç²‰ä¸åˆ—è¡¨ï¼ˆæŸ¥è¯¢æŸä¸ªç”¨æˆ·çš„ç²‰ä¸ï¼‰ï¼Œæ”¯æŒåˆ†é¡µ
  - æƒé™ç®¡ç†ï¼ˆSpring Securityï¼‰
    - æœªç™»å½•ç”¨æˆ·æ— æ³•ä½¿ç”¨å…³æ³¨ç›¸å…³åŠŸèƒ½
- [x] **ç³»ç»Ÿé€šçŸ¥æ¨¡å—**
  - é€šçŸ¥åˆ—è¡¨
    - æ˜¾ç¤ºè¯„è®ºã€ç‚¹èµã€å…³æ³¨ä¸‰ç§ç±»å‹çš„é€šçŸ¥
  - é€šçŸ¥è¯¦æƒ…
    - åˆ†é¡µæ˜¾ç¤ºæŸä¸€ç±»ä¸»é¢˜æ‰€åŒ…å«çš„é€šçŸ¥
    - è¿›å…¥æŸç§ç±»å‹çš„ç³»ç»Ÿé€šçŸ¥è¯¦æƒ…ï¼Œåˆ™å°†è¯¥é¡µçš„æ‰€æœ‰æœªè¯»çš„ç³»ç»Ÿé€šçŸ¥çŠ¶æ€è®¾ç½®ä¸ºå·²è¯»
  - æœªè¯»æ•°é‡
    - åˆ†åˆ«æ˜¾ç¤ºæ¯ç§ç±»å‹çš„ç³»ç»Ÿé€šçŸ¥çš„æœªè¯»æ•°é‡
    - æ˜¾ç¤ºæ‰€æœ‰ç³»ç»Ÿé€šçŸ¥çš„æœªè¯»æ•°é‡
  - å¯¼èˆªæ æ˜¾ç¤ºæ‰€æœ‰æ¶ˆæ¯çš„æœªè¯»æ•°é‡ï¼ˆæœªè¯»ç§ä¿¡ + æœªè¯»ç³»ç»Ÿé€šçŸ¥ï¼‰
  - æƒé™ç®¡ç†ï¼ˆSpring Securityï¼‰
    - æœªç™»å½•ç”¨æˆ·æ— æ³•ä½¿ç”¨ç³»ç»Ÿé€šçŸ¥åŠŸèƒ½
- [x] **æœç´¢æ¨¡å—**
- [x] **ç½‘ç«™æ•°æ®ç»Ÿè®¡**ï¼ˆç®¡ç†å‘˜ä¸“å±ï¼‰
  - ç‹¬ç«‹è®¿å®¢ UV
    - æ”¯æŒå•æ—¥æŸ¥è¯¢å’ŒåŒºé—´æ—¥æœŸæŸ¥è¯¢
  - æ—¥æ´»è·ƒç”¨æˆ· DAU
    - æ”¯æŒå•æ—¥æŸ¥è¯¢å’ŒåŒºé—´æ—¥æœŸæŸ¥è¯¢
  - æƒé™ç®¡ç†ï¼ˆSpring Securityï¼‰
    - åªæœ‰ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹ç½‘ç«™æ•°æ®ç»Ÿè®¡
- [x] **ä¼˜åŒ–ç½‘ç«™æ€§èƒ½**
  - å¤„ç†æ¯æ¬¡è¯·æ±‚æ—¶ï¼Œéƒ½è¦é€šè¿‡æ‹¦æˆªå™¨æ ¹æ®ç™»å½•å‡­è¯æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œè®¿é—®çš„é¢‘ç‡éå¸¸é«˜ã€‚å› æ­¤å°†å·²æˆåŠŸç™»å½•çš„ç”¨æˆ·ä¿¡æ¯åœ¨ç¼“å­˜ Redis ä¸­ä¿å­˜ä¸€æ®µæ—¶é—´ï¼ŒæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯çš„æ—¶å€™ä¼˜å…ˆä»ç¼“å­˜ä¸­å–å€¼ï¼›è‹¥ç¼“å­˜ä¸­æ²¡æœ‰è¯¥ç”¨æˆ·ä¿¡æ¯ï¼Œåˆ™å°†å…¶å­˜å…¥ç¼“å­˜ï¼›ç”¨æˆ·ä¿¡æ¯å˜æ›´æ—¶æ¸…é™¤å¯¹åº”çš„ç¼“å­˜æ•°æ®
  - å¼•å…¥æœ¬åœ°ç¼“å­˜ Caffeineï¼Œç¼“å­˜çƒ­å¸–åˆ—è¡¨å’Œå¸–å­çš„æ€»æ•°ï¼Œæå‡å“åº”é€Ÿåº¦ï¼ˆå¯ä»¥è¿›ä¸€æ­¥é‡‡ç”¨äºŒçº§ç¼“å­˜æ¶æ„ï¼‰

## ğŸŒ± æœ¬åœ°è¿è¡Œ

å„ä½å¦‚æœéœ€è¦å°†é¡¹ç›®éƒ¨ç½²åœ¨æœ¬åœ°è¿›è¡Œæµ‹è¯•ï¼Œä»¥ä¸‹ç¯å¢ƒè¯·æå‰å¤‡å¥½ï¼š

- Java 8
- MySQL 5.7
- Redis
- Kafka 2.13-2.7.0
- Elasticsearch 6.4.3

ç„¶å**ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„ä¿¡æ¯ä¸ºä½ è‡ªå·±çš„æœ¬åœ°ç¯å¢ƒï¼Œç›´æ¥è¿è¡Œæ˜¯è¿è¡Œä¸äº†çš„**ï¼Œè€Œä¸”ç›¸å…³ç§å¯†ä¿¡æ¯æˆ‘å…¨éƒ¨ç”¨ xxxxxxx ä»£æ›¿äº†ã€‚

æœ¬åœ°è¿è¡Œéœ€è¦ä¿®æ”¹çš„é…ç½®æ–‡ä»¶ä¿¡æ¯å¦‚ä¸‹ï¼š

1ï¼‰`application-develop.properties`ï¼š

- MySQL
- Spring Mailï¼ˆé‚®ç®±éœ€è¦å¼€å¯ SMTP æœåŠ¡ï¼‰
- Kafkaï¼šconsumer.group-idï¼ˆè¯¥å­—æ®µè§ Kafka å®‰è£…åŒ…ä¸­çš„ consumer.proertiesï¼Œå¯è‡ªè¡Œä¿®æ”¹, ä¿®æ”¹å®Œæ¯•åéœ€è¦é‡å¯ Kafkaï¼‰
- Elasticsearchï¼šcluster-nameï¼ˆè¯¥å­—æ®µè§ Elasticsearch å®‰è£…åŒ…ä¸­çš„ elasticsearch.ymlï¼Œå¯è‡ªè¡Œä¿®æ”¹ï¼‰
- ä¸ƒç‰›äº‘ï¼ˆéœ€è¦æ–°å»ºä¸€ä¸ªä¸ƒç‰›äº‘çš„å¯¹è±¡å­˜å‚¨ç©ºé—´ï¼Œç”¨æ¥å­˜æ”¾ä¸Šä¼ çš„å¤´åƒå›¾ç‰‡ï¼‰

2ï¼‰`logback-spring-develop.xml`ï¼š

- LOG_PATHï¼šæ—¥å¿—å­˜æ”¾çš„ä½ç½®

æ¯æ¬¡è¿è¡Œéœ€è¦æ‰“å¼€ï¼š

- MySQL
- Redis
- Elasticsearch
- Kafka

å¦å¤–ï¼Œè¿˜éœ€è¦äº‹ä»¶å»ºå¥½æ•°æ®åº“ greatecommunityï¼Œç„¶åä¾æ¬¡è¿è¡Œé¡¹ç›® sql æ–‡ä»¶å¤¹ä¸‹çš„è¿™å‡ ä¸ª sql æ–‡ä»¶å»ºç«‹æ•°æ®åº“è¡¨ï¼š

<img src="https://gitee.com/veal98/images/raw/master/img/20210217134928.png" style="width:386px" />

## ğŸŒŒ éƒ¨ç½²æ¶æ„

æˆ‘æ¯ä¸ªéƒ½åªéƒ¨ç½²äº†ä¸€å°ï¼Œä»¥ä¸‹æ˜¯ç†æƒ³çš„éƒ¨ç½²æ¶æ„ï¼š

<img src="https://gitee.com/veal98/images/raw/master/img/20210211204207.png"  />

## ğŸ¯ åŠŸèƒ½é€»è¾‘å›¾

ç”»äº†ä¸€äº›ä¸æ˜¯é‚£ä¹ˆä¸¥è°¨çš„å›¾å¸®åŠ©å„ä½å°ä¼™ä¼´ç†æ¸…æ€ç»ªã€‚

> å•å‘ç»¿è‰²ç®­å¤´ï¼š
>
> - å‰ç«¯æ¨¡æ¿ -> Controllerï¼šè¡¨ç¤ºè¿™ä¸ªå‰ç«¯æ¨¡æ¿ä¸­æœ‰ä¸€ä¸ªè¶…é“¾æ¥æ˜¯ç”±è¿™ä¸ª Controller å¤„ç†çš„
> - Controller -> å‰ç«¯æ¨¡æ¿ï¼šè¡¨ç¤ºè¿™ä¸ª Controller ä¼šåƒè¯¥å‰ç«¯æ¨¡æ¿ä¼ é€’æ•°æ®æˆ–è€…è·³è½¬
>
> åŒå‘ç»¿è‰²ç®­å¤´ï¼šè¡¨ç¤º Controller å’Œå‰ç«¯æ¨¡æ¿ä¹‹é—´è¿›è¡Œå‚æ•°çš„ç›¸äº’ä¼ é€’æˆ–ä½¿ç”¨
>
> å•å‘è“è‰²ç®­å¤´ï¼š A -> Bï¼Œè¡¨ç¤º A æ–¹æ³•è°ƒç”¨äº† B æ–¹æ³•
>
> å•å‘çº¢è‰²ç®­å¤´ï¼šæ•°æ®åº“æˆ–ç¼“å­˜æ“ä½œ

### æ³¨å†Œ

- ç”¨æˆ·æ³¨å†ŒæˆåŠŸï¼Œå°†ç”¨æˆ·ä¿¡æ¯å­˜å…¥ MySQLï¼Œä½†æ­¤æ—¶è¯¥ç”¨æˆ·çŠ¶æ€ä¸ºæœªæ¿€æ´»
- å‘ç”¨æˆ·å‘é€æ¿€æ´»é‚®ä»¶ï¼Œç”¨æˆ·ç‚¹å‡»é“¾æ¥åˆ™æ¿€æ´»è´¦å·ï¼ˆSpring Mailï¼‰

<img width="660px" src="https://gitee.com/veal98/images/raw/master/img/20210204222249.png" />

### ç™»å½• | ç™»å‡º

ç™»å½•è®¤è¯æ¨¡å—è·³è¿‡äº† Spring Secuity è‡ªå¸¦çš„è®¤è¯æœºåˆ¶ã€‚ä¸»è¦é€»è¾‘å¦‚ä¸‹ï¼š

- è¿›å…¥ç™»å½•ç•Œé¢ï¼Œéšæœºç”Ÿæˆä¸€ä¸ªå­—ç¬¦ä¸²æ¥æ ‡è¯†è¿™ä¸ªå°†è¦ç™»å½•çš„ç”¨æˆ·ï¼Œå°†è¿™ä¸ªå­—ç¬¦ä¸²çŸ­æš‚çš„å­˜å…¥ Cookieï¼ˆ60 ç§’ï¼‰ï¼›
- åŠ¨æ€ç”ŸæˆéªŒè¯ç ï¼Œå¹¶å°†éªŒè¯ç åŠæ ‡è¯†è¯¥ç”¨æˆ·çš„å­—ç¬¦ä¸²çŸ­æš‚å­˜å…¥ Redisï¼ˆ60 ç§’ï¼‰ï¼›
- ä¸ºç™»å½•æˆåŠŸï¼ˆéªŒè¯ç”¨æˆ·åã€å¯†ç ã€éªŒè¯ç ï¼‰çš„ç”¨æˆ·éšæœºç”Ÿæˆç™»å½•å‡­è¯ä¸”è®¾ç½®çŠ¶æ€ä¸ºæœ‰æ•ˆï¼Œå¹¶å°†ç™»å½•å‡­è¯åŠå…¶çŠ¶æ€ç­‰ä¿¡æ¯æ°¸ä¹…å­˜å…¥ Redisï¼Œå†åœ¨ Cookie ä¸­å­˜ä¸€ä»½ç™»å½•å‡­è¯ï¼›
- ä½¿ç”¨æ‹¦æˆªå™¨åœ¨æ‰€æœ‰çš„è¯·æ±‚æ‰§è¡Œä¹‹å‰ï¼Œä» Cookie ä¸­è·å–ç™»å½•å‡­è¯ï¼Œåªè¦ Redis ä¸­è¯¥å‡­è¯æœ‰æ•ˆå¹¶åœ¨æœ‰æ•ˆæœŸå†…ï¼Œæœ¬æ¬¡è¯·æ±‚å°±ä¼šä¸€ç›´æŒæœ‰è¯¥ç”¨æˆ·ä¿¡æ¯ï¼ˆä½¿ç”¨ ThreadLocal æŒæœ‰ç”¨æˆ·ä¿¡æ¯ï¼Œä¿è¯å¤šå°æœåŠ¡å™¨ä¸Šç”¨æˆ·çš„ç™»å½•çŠ¶æ€åŒæ­¥ï¼‰ï¼›
- å‹¾é€‰è®°ä½æˆ‘ï¼Œåˆ™å»¶é•¿ Cookie ä¸­ç™»å½•å‡­è¯çš„æœ‰æ•ˆæ—¶é—´ï¼›
- ç”¨æˆ·ç™»å‡ºï¼Œå°†å‡­è¯çŠ¶æ€è®¾ä¸ºæ— æ•ˆï¼Œå¹¶æ›´æ–° Redis ä¸­è¯¥ç™»å½•å‡­è¯çš„ç›¸å…³ä¿¡æ¯ã€‚

ä¸‹å›¾æ˜¯ç™»å½•æ¨¡å—çš„åŠŸèƒ½é€»è¾‘å›¾ï¼Œå¹¶æ²¡æœ‰ä½¿ç”¨ Spring Security æä¾›çš„è®¤è¯é€»è¾‘ï¼ˆæˆ‘è§‰å¾—è¿™ä¸ªæ¨¡å—æ˜¯æœ€å¤æ‚çš„ï¼Œè¿™å¼ å›¾å…¶å®å¾ˆå¤šç»†èŠ‚è¿˜æ²¡æœ‰ç”»å…¨ï¼‰

![](https://gitee.com/veal98/images/raw/master/img/20210204233233.png)

### åˆ†é¡µæ˜¾ç¤ºæ‰€æœ‰çš„å¸–å­

- æ”¯æŒæŒ‰ç…§ â€œå‘å¸–æ—¶é—´â€ æ˜¾ç¤º
- æ”¯æŒæŒ‰ç…§ â€œçƒ­åº¦æ’è¡Œâ€ æ˜¾ç¤ºï¼ˆSpring Quartzï¼‰
- å°†çƒ­å¸–åˆ—è¡¨å’Œæ‰€æœ‰å¸–å­çš„æ€»æ•°å­˜å…¥æœ¬åœ°ç¼“å­˜ Caffeineï¼ˆåˆ©ç”¨åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡ Spring Quartz æ¯éš”ä¸€æ®µæ—¶é—´å°±åˆ·æ–°è®¡ç®—å¸–å­çš„çƒ­åº¦/åˆ†æ•° â€” è§ä¸‹æ–‡ï¼Œè€Œ Caffeine é‡Œçš„æ•°æ®æ›´æ–°ä¸ç”¨æˆ‘ä»¬æ“å¿ƒï¼Œå®ƒå¤©ç”Ÿå°±ä¼šè‡ªåŠ¨çš„æ›´æ–°å®ƒæ‹¥æœ‰çš„æ•°æ®ï¼Œç»™å®ƒä¸€ä¸ªåˆå§‹åŒ–æ–¹æ³•å°±å®Œäº‹å„¿ï¼‰

<img width="660px" src="https://gitee.com/veal98/images/raw/master/img/20210204222822.png" />



### è´¦å·è®¾ç½®

- ä¿®æ”¹å¤´åƒï¼ˆå¼‚æ­¥è¯·æ±‚ï¼‰
  - å°†ç”¨æˆ·é€‰æ‹©çš„å¤´åƒå›¾ç‰‡æ–‡ä»¶ä¸Šä¼ è‡³ä¸ƒç‰›äº‘æœåŠ¡å™¨
- ä¿®æ”¹å¯†ç 

æ­¤å¤„åªç”»å‡ºä¿®æ”¹å¤´åƒï¼š

<img width="700px" src="https://gitee.com/veal98/images/raw/master/img/20210206121201.png" />

### å‘å¸ƒå¸–å­ï¼ˆå¼‚æ­¥è¯·æ±‚ï¼‰

å‘å¸ƒå¸–å­ï¼ˆè¿‡æ»¤æ•æ„Ÿè¯ï¼‰ï¼Œå°†å…¶å­˜å…¥ MySQL

<img width="660px" src="https://gitee.com/veal98/images/raw/master/img/20210206122521.png" />

### æ˜¾ç¤ºè¯„è®ºåŠç›¸å…³ä¿¡æ¯

> è¯„è®ºéƒ¨åˆ†å‰ç«¯çš„åç§°æ˜¾ç¤ºæœ‰äº›ç¼ºé™·ï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´æ¬¢è¿æ PR è§£å†³ ~

å…³äºè¯„è®ºæ¨¡å—éœ€è¦æ³¨æ„çš„å°±æ˜¯è¯„è®ºè¡¨çš„è®¾è®¡ï¼ŒæŠŠæ¡å…¶ä¸­å­—æ®µçš„å«ä¹‰ï¼Œæ‰èƒ½é€å½»äº†è§£è¿™ä¸ªåŠŸèƒ½çš„é€»è¾‘ã€‚

è¯„è®º Comment çš„ç›®æ ‡ç±»å‹ï¼ˆå¸–å­ï¼Œè¯„è®ºï¼‰ entityType å’Œ entityId ä»¥åŠå¯¹å“ªä¸ªç”¨æˆ·è¿›è¡Œè¯„è®º/å›å¤ targetId æ˜¯ç”±å‰ç«¯ä¼ é€’ç»™ DiscussPostController çš„

<img width="660px" src="https://gitee.com/veal98/images/raw/master/img/20210207150925.png" />

ä¸€ä¸ªå¸–å­çš„è¯¦æƒ…é¡µéœ€è¦å°è£…çš„ä¿¡æ¯å¤§æ¦‚å¦‚ä¸‹ï¼š

<img width="660px" src="https://gitee.com/veal98/images/raw/master/img/20210207151328.png" />

### æ·»åŠ è¯„è®ºï¼ˆäº‹åŠ¡ç®¡ç†ï¼‰

å‘å¸ƒå¯¹å¸–å­çš„è¯„è®ºï¼ˆè¿‡æ»¤æ•æ„Ÿè¯ï¼‰ï¼Œå°†å…¶å­˜å…¥ MySQL

<img width="660px" src="https://gitee.com/veal98/images/raw/master/img/20210207122908.png" />

### ç§ä¿¡åˆ—è¡¨å’Œè¯¦æƒ…é¡µ

<img width="700px" src="https://gitee.com/veal98/images/raw/master/img/20210207161130.png" />

### å‘é€ç§ä¿¡ï¼ˆå¼‚æ­¥è¯·æ±‚ï¼‰

<img width="660px" src="https://gitee.com/veal98/images/raw/master/img/20210207161500.png" />

### ç‚¹èµï¼ˆå¼‚æ­¥è¯·æ±‚ï¼‰

å°†ç‚¹èµç›¸å…³ä¿¡æ¯å­˜å…¥ Redis çš„æ•°æ®ç»“æ„ set ä¸­ã€‚å…¶ä¸­ï¼Œkey å‘½åä¸º  `like:entity:entityType:entityId`ï¼Œvalue å³ç‚¹èµç”¨æˆ·çš„ idã€‚æ¯”å¦‚ key =  `like:entity:2:246`  value =  `11` è¡¨ç¤ºç”¨æˆ· 11 å¯¹å®ä½“ç±»å‹ 2 å³è¯„è®ºè¿›è¡Œäº†ç‚¹èµï¼Œè¯¥è¯„è®ºçš„ id æ˜¯ 246

æŸä¸ªç”¨æˆ·çš„è·èµæ•°é‡å¯¹åº”çš„å­˜å‚¨åœ¨ Redis ä¸­çš„ key æ˜¯ `like:user:userId`ï¼Œvalue å°±æ˜¯è¿™ä¸ªç”¨æˆ·çš„è·èµæ•°é‡

<img width="700px" src="https://gitee.com/veal98/images/raw/master/img/20210207165837.png"  />

### æˆ‘çš„è·èµæ•°é‡

<img width="660px" src="https://gitee.com/veal98/images/raw/master/img/20210207170003.png" />

### å…³æ³¨ï¼ˆå¼‚æ­¥è¯·æ±‚ï¼‰

- è‹¥ A å…³æ³¨äº† Bï¼Œåˆ™ A æ˜¯ B çš„ç²‰ä¸ Followerï¼ŒB æ˜¯ A çš„ç›®æ ‡ Followee
- å…³æ³¨çš„ç›®æ ‡å¯ä»¥æ˜¯ç”¨æˆ·ã€å¸–å­ã€é¢˜ç›®ç­‰ï¼Œåœ¨å®ç°æ—¶å°†è¿™äº›ç›®æ ‡æŠ½è±¡ä¸ºå®ä½“ï¼ˆç›®å‰åªåšäº†å…³æ³¨ç”¨æˆ·ï¼‰

å°†æŸä¸ªç”¨æˆ·å…³æ³¨çš„å®ä½“ç›¸å…³ä¿¡æ¯å­˜å‚¨åœ¨ Redis çš„æ•°æ®ç»“æ„ zset ä¸­ï¼škey æ˜¯ `followee:userId:entityType` ï¼Œå¯¹åº”çš„ value æ˜¯ `zset(entityId, now)` ï¼Œä»¥å…³æ³¨çš„æ—¶é—´è¿›è¡Œæ’åºã€‚æ¯”å¦‚è¯´ `followee:111:3` å¯¹åº”çš„value `(20, 2020-02-03-xxxx)`ï¼Œè¡¨æ˜ç”¨æˆ· 111 å…³æ³¨äº†ä¸€ä¸ªç±»å‹ä¸º 3 çš„å®ä½“å³äºº(ç”¨æˆ·)ï¼Œå…³æ³¨çš„è¿™ä¸ªå®ä½“ id æ˜¯ 20ï¼Œå…³æ³¨è¯¥å®ä½“çš„æ—¶é—´æ˜¯ 2020-02-03-xxxx

åŒæ ·çš„ï¼Œå°†æŸä¸ªå®ä½“æ‹¥æœ‰çš„ç²‰ä¸ç›¸å…³ä¿¡æ¯ä¹Ÿå­˜å‚¨åœ¨ Redis çš„æ•°æ®ç»“æ„ zset ä¸­ï¼škey æ˜¯ `follower:entityType:entityId`ï¼Œå¯¹åº”çš„ value æ˜¯ `zset(userId, now)`ï¼Œä»¥å…³æ³¨çš„æ—¶é—´è¿›è¡Œæ’åº

<img width="660px" src="https://gitee.com/veal98/images/raw/master/img/20210207174046.png" />

### å…³æ³¨åˆ—è¡¨

<img width="660px" src="https://gitee.com/veal98/images/raw/master/img/20210207175621.png" />

### å‘é€ç³»ç»Ÿé€šçŸ¥

![](https://gitee.com/veal98/images/raw/master/img/20210207182917.png)

### æ˜¾ç¤ºç³»ç»Ÿé€šçŸ¥

![](https://gitee.com/veal98/images/raw/master/img/20210208153059.png)

### æœç´¢

- å‘å¸ƒäº‹ä»¶
  - å‘å¸ƒå¸–å­æ—¶ï¼Œé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å°†å¸–å­å¼‚æ­¥åœ°æäº¤åˆ° Elasticsearch æœåŠ¡å™¨
  - ä¸ºå¸–å­å¢åŠ è¯„è®ºæ—¶ï¼Œé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å°†å¸–å­å¼‚æ­¥åœ°æäº¤åˆ° Elasticsearch æœåŠ¡å™¨
- æœç´¢æœåŠ¡
  - ä» Elasticsearch æœåŠ¡å™¨æœç´¢å¸–å­
  - ä» Elasticsearch æœåŠ¡å™¨åˆ é™¤å¸–å­ï¼ˆå½“å¸–å­ä»æ•°æ®åº“ä¸­è¢«åˆ é™¤æ—¶ï¼‰
- æ˜¾ç¤ºæœç´¢ç»“æœ

![](https://gitee.com/veal98/images/raw/master/img/20210208161936.png)

ç±»ä¼¼çš„ï¼Œç½®é¡¶ã€åŠ ç²¾ä¹Ÿä¼šè§¦å‘å‘å¸–äº‹ä»¶ï¼Œå°±ä¸å†å›¾é‡Œé¢ç”»å‡ºæ¥äº†ã€‚

### ç½®é¡¶åŠ ç²¾åˆ é™¤ï¼ˆå¼‚æ­¥è¯·æ±‚ï¼‰

<img width="660px" src="https://gitee.com/veal98/images/raw/master/img/20210208171729.png" />

### ç½‘ç«™æ•°æ®ç»Ÿè®¡

- ç‹¬ç«‹è®¿å®¢ UV
  - å­˜å…¥ Redis çš„ HyperLogLog
  - æ”¯æŒå•æ—¥æŸ¥è¯¢å’ŒåŒºé—´æ—¥æœŸæŸ¥è¯¢
- æ—¥æ´»è·ƒç”¨æˆ· DAU
  - å­˜å…¥ Redis çš„ Bitmap
  - æ”¯æŒå•æ—¥æŸ¥è¯¢å’ŒåŒºé—´æ—¥æœŸæŸ¥è¯¢
- æƒé™ç®¡ç†ï¼ˆSpring Securityï¼‰
  - åªæœ‰ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹ç½‘ç«™æ•°æ®ç»Ÿè®¡

![](https://gitee.com/veal98/images/raw/master/img/20210208170801.png)

### å¸–å­çƒ­åº¦è®¡ç®—

æ¯æ¬¡å‘ç”Ÿç‚¹èµï¼ˆç»™å¸–å­ç‚¹èµï¼‰ã€è¯„è®ºï¼ˆç»™å¸–å­è¯„è®ºï¼‰ã€åŠ ç²¾çš„æ—¶å€™ï¼Œå°±å°†è¿™äº›å¸–å­ä¿¡æ¯å­˜å…¥ç¼“å­˜ Redis ä¸­ï¼Œç„¶åé€šè¿‡åˆ†å¸ƒå¼çš„å®šæ—¶ä»»åŠ¡ Spring Quartzï¼Œæ¯éš”ä¸€æ®µæ—¶é—´å°±ä»ç¼“å­˜ä¸­å–å‡ºè¿™äº›å¸–å­è¿›è¡Œè®¡ç®—åˆ†æ•°ã€‚

å¸–å­åˆ†æ•°/çƒ­åº¦è®¡ç®—å…¬å¼ï¼šåˆ†æ•°ï¼ˆçƒ­åº¦ï¼‰ = æƒé‡ + å‘å¸–è·ç¦»å¤©æ•°

```java
// è®¡ç®—æƒé‡
double w = (wonderful ? 75 : 0) + commentCount * 10 + likeCount * 2;
// åˆ†æ•° = æƒé‡ + å‘å¸–è·ç¦»å¤©æ•°
double score = Math.log10(Math.max(w, 1))
        + (post.getCreateTime().getTime() - epoch.getTime()) / (1000 * 3600 * 24);
```

![](https://gitee.com/veal98/images/raw/master/img/20210208173636.png)
